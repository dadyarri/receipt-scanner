# Сканер чеков

## Описание

Консольная утилита, строящая круговую диаграмму с категориями покупок.

Может брать данные из:

* QR - кодов с российских чеков
* CSV - файлов

## Зависимости

Для управления зависимостями используется pipenv (https://github.com/pypa/pipenv)

```
python >= 3.8
pipenv
requests
pillow
pyzbar
pyyaml
matplotlib
pandas
tabulate
```

Установка: `pipenv install`

## Формат данных

В папке со скриптом должна быть директория `source`, в которой находятся подпапки с именами формата `неделя-месяц`. В этих подпапках фотографии чеков в формате *.png и файлы *.csv

### Файловая структура

```
.
├── source/
│   ├── 1-4/
│   │   ├── 001.png
│   │   ├── 002.png
│   │   └── goods.csv
│   └── 2-4/
│       ├── 001.png
│       ├── 002.png
│       └── goods.csv  
└── main.py
```

### Формат CSV файла

*(Его наличие не обязательно)*

```csv
имя_товара,количество,цена_за_штуку
```

## Вывод

В консоли печатается читабельная таблица с информацией по всем покупкам и в новом окне открывается диаграмма по категориям

### Пример

```
+----+----------------------------------------------------------+------------+---------+---------+------------+
|    | name                                                     |  quantity  |  price  |   sum   | category   |
|----+----------------------------------------------------------+------------+---------+---------+------------|
| 0  | квас                                                     |     1      |  5500   |   55    | напитки    |
| 1  | пакет                                                    |     1      |   550   |   5.5   | быт        |
| 2  | хлеб                                                     |     2      |  2700   |   54    | хлеб       |
| 3  | хлеб                                                     |     1      |  1900   |   19    | хлеб       |
| 4  | хлеб                                                     |     1      |  3200   |   32    | хлеб       |
| 5  | вода                                                     |     1      |  2500   |   25    | напитки    |
| 6  | чистящее средство                                        |     1      |  7990   |  79.9   | быт        |
| 7  | крем                                                     |     1      |  4630   |  46.3   | быт        |
| 8  | греча                                                    |     1      |  6990   |  69.9   | зерновые   |
| 9  | майонез                                                  |     1      |  8990   |  89.9   | соусы      |
| 10 | з/паста                                                  |     1      |  5790   |  57.9   | быт        |
| 11 | соль                                                     |     1      |  1490   |  14.9   | приправы   |
| 12 | яйцо                                                     |     4      |  4950   |   198   | яйца       |
| 13 | масло подсолнечное                                       |     1      |  7990   |  79.9   | бакалея    |
| 14 | капуста                                                  |   1.148    |   991   | 11.3767 | овощи      |
| 15 | пиво                                                     |     3      |  3990   |  119.7  | алкоголь   |
| 16 | сахар                                                    |   2.772    |  2890   | 80.1108 | сладкое    |
| 17 | спагетти                                                 |     1      |  3550   |  35.5   | бакалея    |
| 18 | макароны                                                 |     1      |  3550   |  35.5   | бакалея    |
| 19 | колбаса                                                  |    0.71    |  25432  | 180.567 | мясо       |
| 20 | ванилин                                                  |     3      |   137   |  4.11   | выпечка    |
| 21 | какао                                                    |     1      |  6750   |  67.5   | напитки    |
| 22 | геркулес                                                 |     1      |  2989   |  29.89  | зерновые   |
| 23 | рис                                                      |     1      |  7550   |  75.5   | зерновые   |
| 24 | булавки                                                  |     1      |  3479   |  34.79  | быт        |
| 25 | корзина                                                  |     1      |  8320   |  83.2   | быт        |
| 26 | пиво                                                     |     2      |  4000   |   80    | алкоголь   |
| 27 | ОЧАКОВСКИЙ Квас 2л пл/бут(Очаково):6                     |     1      |  79.9   |  79.9   | напитки    |
| 28 | Картофель молодой 1кг (вес)                              |    1.32    |  37.92  |  50.05  | овощи      |
| 29 | Картофель молодой 1кг (вес)                              |     1      |  37.93  |  37.93  | овощи      |
| 30 | Помидоры тепличные 1кг (вес)                             |   1.608    |  66.15  | 106.37  | овощи      |
| 31 | Огурцы Тристан 1кг (вес)                                 |   1.008    |  58.31  |  58.78  | овощи      |
| 32 | ПЕРЧАТКИ СМОТР SFM НИТРИЛ Н/СТЕР НЕОПУДР                 |     1      |   21    |   21    | быт        |
| 33 | Батон НАРЕЗНОЙ "К ЧАЮ" 300 гр                            |     2      |   27    |   54    | хлеб       |
| 34 | ОГУРЦЫ гладкие 1кг                                       |   0.908    |  79.9   |  72.55  | овощи      |
| 35 | ВЛАД СТАНД Сосиски Баварские 0,42кг МГС:6                |     1      |  84.9   |  84.9   | мясо       |
| 36 | РУССКИЙ ДАР Квас 2л(Пепси):6                             |     1      |  54.9   |  54.9   | напитки    |
| 37 | ORBIT Белоснеж Жев резин соч яблоко XXL 20,4г(Ри         |     1      |  39.99  |  39.99  | сладкое    |
| 38 | ПАКЕТ МАЙКА                                              |     1      |    3    |    3    | быт        |
| 39 | Чай черный Curtis "Classic Ceylon" с/я, 100пак*1,7гр.    |     1      |  109.7  |  109.7  | напитки    |
| 40 | Вафли 600 гр, (ГОСТ)                                     |     1      |  48.9   |  48.9   | сладкое    |
| 41 | Чипсы Лейс, 225гр.                                       |     1      |  81.5   |  81.5   | закуски    |
| 42 | Колбаски мини салями со вкусом хамона, с/к, с/з, 250 гр. |     1      |  99.8   |  99.8   | закуски    |
| 43 | Мешок д/мусора 60 л / 100 шт.                            |     1      |  64.3   |  64.3   | быт        |
| 44 | 4690471134777 Floom classic бум туалетная 2сл белая 24ШТ |     1      |   200   |   200   | быт        |
| 45 | Колбаски мини салями со вкусом хамона, с/к, с/з, 250 гр. |     1      |  99.8   |  99.8   | закуски    |
| 46 | Чипсы Лейс, 225гр.                                       |     1      |  81.5   |  81.5   | закуски    |
| 47 | Ящик с крышкой створками 53л                             |     1      |  250.2  |  250.2  | быт        |
| 48 | Батон НАРЕЗНОЙ "К ЧАЮ" 300 гр                            |     2      |   27    |   54    | хлеб       |
| 49 | Хлеб на смеси "ДАТСКАЯ" 300 гр                           |     1      |   32    |   32    | хлеб       |
| 50 | Хлеб "ДОБРЫЙ"  ржаной 350 гр                             |     1      |   19    |   19    | хлеб       |
| 51 | КЕКС МИНИ ПЛОМБИР весовое\3,0                            |   0.546    |   150   |  81.9   | сладкое    |
+----+----------------------------------------------------------+------------+---------+---------+------------+
```

![Screenshot_20200701_203304](https://user-images.githubusercontent.com/51821039/86274528-7ba69200-bbda-11ea-85ff-177e11c7c0db.png)


Так же производится попытка отправки полученной диаграммы на подключенный через KDE Connect телефон.

## Планы

- [x] Рефактор
- [x] Убрать зависимость от конкретного имени CSV файла (работать со всеми csv файлами в директории)
- [x] Перейти на logging вместо print'ов 
- [x] Сделать скрипт полноценной консольной утилитой, не зависимой от структуры каталогов
- [ ] Обновить раздел "Использование" в README
- [ ] Приделать сортировку по дате
- [ ] Написать инсталлятор
    - [ ] Возможно, проблема в использовании Pipenv?
- [ ] Что не так с отправкой фотографии на телефон (возможно вообще стоит удалить)
